require(["jquery","imagesloaded","url-utilities"],function($,imagesLoaded,urlUtil){$.fn.imagesLoaded=imagesLoaded,window.optimizely=window.optimizely||[];var pageBoundaries=[],slideBoundaries=[],debugging=!1,isOptimizelyVariation="true"===urlUtil.getQueryParams().listicle,nextShowTracked=!1;$(document).ready(function(){function setVeryLastSlide(){$(".article__listicle .listicle--slide").last().addClass("listicle--slide__last")}function handleViews(){var i=0,$pageImages=$(".listicle--slide:nth-child(3n+1) .listicle--image"),$slideImages=$(".listicle--slide .listicle--image"),bottomBoundary=$(window).scrollTop()+$(window).height();for(i=0;i<$slideImages.length;i++){var $slide=$($slideImages[i]).parents(".listicle--slide"),slideHeight=$slide.offset().top+$slide.outerHeight(!0);void 0===slideBoundaries[i]?slideBoundaries[i]={top:slideHeight,fired:!1}:slideBoundaries[i].top=slideHeight}for(i=1;i<$pageImages.length;i++){var $page=$($pageImages[i]).parents(".listicle--slide"),pageHeight=$page.offset().top+$page.outerHeight(!0);debugging&&$("#line_"+i).css("top",pageHeight),void 0===pageBoundaries[i]?pageBoundaries[i]={top:pageHeight,fired:!1}:pageBoundaries[i].top=pageHeight}for(i=0;i<slideBoundaries.length;i++)isOptimizelyVariation&&void 0!==slideBoundaries[i]&&slideBoundaries[i].fired===!1&&slideBoundaries[i].top<bottomBoundary&&(window.optimizely.push(["trackEvent","slide_viewed"]),slideBoundaries[i].fired=!0);for(i=1;i<pageBoundaries.length;i++)if(void 0!==pageBoundaries[i]&&pageBoundaries[i].fired===!1&&pageBoundaries[i].top<bottomBoundary){try{CN.stats.omniture.setPaginationValue("list_"+(i+1)).trackAjaxPage()}catch(err){}pageBoundaries[i].fired=!0}}function setLimitsOnFixedElements(){$(".listicle--wrapper").each(function(){var $listicleWrapper=$(this),$listicleWrapperFooter=$listicleWrapper.find(".article-copy--footer"),$shareToolsLinks=$listicleWrapper.find(".social-sharer__content .social-sharer--share-links"),listicleWrapperFooterHeight=$listicleWrapperFooter.outerHeight(!0);$shareToolsLinks.css("margin-bottom",listicleWrapperFooterHeight)})}function handleScroll(){handleViews();var distanceScrolled=$(window).scrollTop()+$(window).height();isOptimizelyVariation&&$(".infinite-view-1").length&&distanceScrolled>=$(".infinite-view-1").offset().top&&!nextShowTracked&&(window.optimizely.push(["trackEvent","next_show"]),nextShowTracked=!0)}function handleResize(){handleViews(),setLimitsOnFixedElements()}function setSlideClass(){var $slides=$(".listicle--slide");$slides.each(function(){var $slide=$(this),$image=$slide.find(".listicle--image--img"),$description=$slide.find(".listicle--description");($image.height()<$description.height()||$("html").hasClass("touch")===!0)&&($slide.hasClass("listicle--slide__left")?$slide.removeClass("listicle--slide__left").addClass("listicle--slide__left__large"):$slide.hasClass("listicle--slide__right")&&$slide.removeClass("listicle--slide__right").addClass("listicle--slide__right__large"),$slide.addClass("clearfix"))})}function handleImages(){var $images=$(".listicle--slide:last-child .listicle--image--img");$images.imagesLoaded().progress(function(instance,image){var $slide=$(image.img).parents(".listicle--slide"),$articleListicle=$slide.parents(".article__listicle"),$ad=$articleListicle.find(".side-bar--skyscraper-adcall");$ad.css("margin-bottom",$slide.outerHeight(!0))}).done(function(){handleViews()})}function initialize(){if(handleImages(),setSlideClass(),setVeryLastSlide(),setLimitsOnFixedElements(),$(window).on("scroll",handleScroll),$(window).on("resize",handleResize),debugging){var i=0,$images=$(".listicle--slide:nth-child(3n+1) .listicle--image");$images.each(function(){i>0&&$("body").append('<div id="line_'+i+'" style="position: absolute; height: 1px; background-color: red; z-index: 99999999999999999; left: 0; right: 0; top: 99999999999999999px;"></div>'),i++})}}$(document.body).on("post-load",function(){initialize()}),initialize()})});