define(["jquery","breakpoint-manager","picturefill","harvey","social-links","transit","fitvids","expanded-image-manager","comments-manager","text-tweet","cookie","outbrain-article"],function($,bp,picturefill,Harvey,SocialLinks){var ArticleManager=function(){function init(){embedVideos(),polls(),setCollectionMenuWidth(),setCollectionSidebarMargin(),bindEventHandlers(),setupOmnitureListeners(),$(document.body).on("post-load",function(){embedVideos(),polls(),checkRadios()})}function bindEventHandlers(){$("body").on("click",".collection-detail--menu-item",function(){if(!$(this).hasClass("collection-detail--menu-item__selected")){var section=$(this).attr("data-section");$(this).addClass("collection-detail--menu-item__selected").siblings().removeClass("collection-detail--menu-item__selected"),$(this).closest(".article-copy").find(".collection-detail--section__"+section).show().siblings(".collection-detail--section").hide()}}),$("body").on("click",".collection-detail--load-button",function(){$(this).closest(".collection-detail--load").hide().siblings(".collection-detail--ajax-loader").show();var section=$(this).attr("data-section"),id=$(this).attr("data-id"),$container=$(this).closest(".collection-detail--section").find(".collection-detail--grid");$.ajax({url:"/wp-admin/admin-ajax.php",data:"action=vogue_collection_section&id="+id+"&section="+section,success:function(response){$container.append(response),$container.siblings(".collection-detail--ajax-loader").remove(),picturefill()}})}),$(document).on("scroll",function(){setLimitsOnFixedElements()}),$(window).on("resize",function(){setLimitsOnFixedElements()})}function setLimitsOnFixedElements(){$(".article-copy").each(function(){var $articleCopy=$(this),$articleCopyFooter=$articleCopy.find(".article-copy--footer"),$articleContentColumns=$articleCopy.parents(".article-content--columns"),$shareToolsLinks=$articleContentColumns.find(".social-sharer__content .social-sharer--share-links"),$adRightRail=$articleContentColumns.find(".side-bar--skyscraper-adcall"),h=$articleCopyFooter.outerHeight(!0);$shareToolsLinks.css("margin-bottom",h),$adRightRail.css("margin-bottom",h)})}function setupOmnitureListeners(){$("body").on("click",".related-stories--list .list--item",function(){CN.stats.omniture.trackActionEvar("click",this,"eVar10","leftRail|relatedStories"),s.events="",s.eVar10=""})}function embedVideos(){$(".embedded-media.youtube").fitVids()}function polls(){$(".poll:not(.initialized)").each(function(index,item){var target=$(item),id=target.attr("data-id");"undefined"!=typeof id&&(initilaizePoll(id),target.addClass("initialized"))})}function initilaizePoll(poll_id){$(".poll[data-id="+poll_id+"]").attr("data-total");if(percentages(poll_id),"undefined"!=typeof $.cookie(poll_id.toString()))return void $(".poll[data-id="+poll_id+"]").addClass("poll__voted");var poll_vote_time,poll_vote_hash;$.get("/wp-content/themes/vogue/vogue-voting.php").done(function(data){var response=JSON.parse(data);poll_vote_time=response.vote_time,poll_vote_hash=response.vote_hash}),$(".poll[data-id="+poll_id+"]:not(.poll__voted) .view-results").on("click",function(){var target=$(this).parents(".poll");target.find(".poll-voting").hide(),target.find(".results").show()}),$(".poll[data-id="+poll_id+"]:not(.poll__voted) .votes-total").on("click",function(){var target=$(this).parents(".poll");target.find(".poll-voting").show(),target.find(".results").hide()}),$(".poll[data-id="+poll_id+"]:not(.poll__voted) .vote").on("click",function(){var target=$(this).parents(".poll");if(0!=target.find("input:checked").length){var selected=target.find("input:checked"),idx=selected.val(),id=target.attr("data-id");$.cookie(id.toString(),idx,{expires:365}),target.addClass("poll__voted"),target.find(".vote").off(),$.post("/wp-admin/admin-ajax.php",{action:"vogue_poll_voting",meta_key:idx,vote_time:poll_vote_time,post_id:id,vote_hash:poll_vote_hash},function(e){target.find(".poll-voting").hide(),target.find(".votes-total span").html(parseInt(target.find(".votes-total span").html())+1),target.find("."+idx+" .bar").attr("data-votes",parseInt(target.find("."+idx+" .bar").attr("data-votes"))+1),target.attr("data-total",parseInt(target.attr("data-total"))+1),percentages(poll_id),$(".poll[data-id="+poll_id+"] .votes-total").unbind(),target.find(".results").show()})}})}function percentages(poll_id){$(".poll[data-id="+poll_id+"] .results .result").each(function(index,item){var bar=$(item).find(".bar"),votes=bar.attr("data-votes"),total=$(".poll[data-id="+poll_id+"]").attr("data-total"),percentage=Math.round(votes/total*100);isNaN(percentage)&&(percentage=0);var percentage_string=percentage+"<span>%</span>";bar.find(".fill").css("left",-(100-percentage)+"%"),bar.find(".numbers").html(percentage_string)})}function checkRadios(){var $radios=$("input[type=radio]:not(.input_styled)"),checked={radio:"radio__styled__checked",checkbox:"checkbox__styled__checked"};$radios.each(function(){var $radio=$(this),$span=$('<span class="radio__styled"></span>');$radio.hide(),$radio.siblings().hasClass("radio__styled")||$radio.before($span),$radio.prop("checked")&&$span.addClass(checked.radio),$span.on("click",function(){$radio.prop("checked",function(i,val){return!val}),$radio.trigger("change")}),$radio.on("change",function(){$radios.each(function(){$(this).prop("checked")?$(this).prev().addClass(checked.radio):$(this).prev().removeClass(checked.radio)})})})}function setCollectionMenuWidth(){var width=0;$(".collection-detail--menu-item").each(function(){width+=$(this).outerWidth(!0)}),$(".collection-detail--menu-items").width(width+5)}function setCollectionSidebarMargin(){function setMargin(){var $header=$(".article-content--header__collections"),height=$header.outerHeight(!0)-parseInt($header.css("margin-bottom"),10);height&&$(".article-content--side-bar").css("margin-top",height+30)}Harvey.attach("screen and (min-width:960px)",{on:function(){setMargin()},off:function(){setMargin()}}),Harvey.attach("screen and (min-width:1260px)",{on:function(){setMargin()},off:function(){setMargin()}})}return{init:init}}();return $(document).ready(function(){ArticleManager.init()}),ArticleManager});