define(["jquery","picturefill","gif-manager","social-links"],function($,picturefill,gifManager,SocialLinks){function init(){var $expandedImage=$(".expanded-image");$(document.body).on("post-load",function(){init()}),$(window).on("resize",function(){positionImageWrapper()}),$(".expanded-image-marker").not(".expanded-image-marker__no-js").parent().find("img").not(".expanded-image--img").off().on("click",handleExpandedImageMarkerClick),$(".silhouette .content-full-image__fullbleed .picture-img").off(),$(".expanded-image-marker").off().on("click",handleExpandedImageMarkerClick),$(".expanded-image").off().on("click",function(event){"icon-facebook"!==event.target.className&&"icon-pinterest"!==event.target.className&&close($(this).find(".expanded-image--close"))}),$expandedImage.find(".expanded-image--close").off().on("click",function(event){close($(this))}),$expandedImage.find(".expanded-image--description").off().on("click",function(event){event.stopPropagation()})}function handleExpandedImageMarkerClick(event){var $expandedImage=($(this),$(this).parent().find(".expanded-image"));$expandedImage.length||($expandedImage=$(this).parents(".content-image--wrapper").find(".expanded-image")),1==$expandedImage.length&&open($expandedImage),$(".site-container").addClass("expanded-image__open")}function open($expandedImage){var $expandedImageImage=$expandedImage.find(".expanded-image--image"),dataPictureUrl=$expandedImage.find(".expanded-image--image").data("picture_url");dataPictureUrl?openWithDataPicture($expandedImageImage,dataPictureUrl):openWithDataSrcset($expandedImage),positionImageWrapper(),$expandedImage.fadeIn(),null==scrollTop&&(scrollTop=$(window).scrollTop()),$(".site-container").css({height:0,overflow:"hidden"}),gifManager.toggle($expandedImage.parent(),$expandedImageImage)}function openWithDataPicture($expandedImageImage,dataPictureUrl){$expandedImageImage.html($expandedImageImage.html().split("__picture_url__").join(dataPictureUrl)),picturefill({elements:[$expandedImageImage[0]]})}function openWithDataSrcset($expandedImage){var $img=$expandedImage.find("img"),src=$img.attr("data-src");$($expandedImage.find("source").get().reverse()).each(function(){var $this=$(this),srcset=$this.attr("data-srcset");$this.attr("srcset",srcset);var srcWidth=parseInt($this.attr("data-width"));!isNaN(srcWidth)&&document.body.clientWidth>=srcWidth&&(src=srcset)}),$img.attr("src",src)}function close($close){$expandedImage=$close.parents(".expanded-image"),$expandedImage.fadeOut(),$(".site-container").removeAttr("style"),$(".site-container").removeClass("expanded-image__open"),null!=scrollTop&&($(window).scrollTop(scrollTop),scrollTop=null),gifManager.toggle($expandedImage.find(".expanded-image--image"),$expandedImage.siblings())}function positionImageWrapper(){$(".expanded-image-marker").each(function(){var $expandedImage=$(this).siblings(".expanded-image"),opacity=$expandedImage.css("opacity"),display=$expandedImage.css("display");$expandedImage.css({opacity:"0",display:"block"});var descriptionHeight=parseInt($expandedImage.find(".expanded-image--description").outerHeight(!0)),descriptionHeightMinimum=60,imageWrapperBottom=Math.max(descriptionHeight,descriptionHeightMinimum);$expandedImage.find(".expanded-image--image-wrapper").css("bottom",imageWrapperBottom),$expandedImage.css({opacity:opacity,display:display})})}return scrollTop=null,$(document).ready(function(){init()}),{init:init}});